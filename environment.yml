# PET-CT Radiomics Pipeline - Cross-platform Environment
# バージョン互換性問題を解決するため、明示的にバージョンを固定
#
# 使用方法:
#   conda env create -f environment.yml
#   conda activate med_ai
#
# 注意: PyTorch 2.2.x と TotalSegmentator 2.11.0 の互換性問題を解決済み
#       NumPy 2.x と PyRadiomics の競合を解決済み

name: med_ai
channels:
  - conda-forge
  - pytorch
  - defaults

dependencies:
  # Python
  - python=3.10

  # --- 重要: バージョン固定 ---
  # NumPy: 1.x系を使用（NumPy 2.xはPyTorch/TotalSegmentatorと非互換）
  - numpy>=1.26,<2.0

  # PyTorch: 2.4以上を推奨（torch._dynamo互換性のため）
  - pytorch>=2.4
  - torchvision

  # 基本ライブラリ
  - pandas>=2.0
  - matplotlib>=3.7
  - pyyaml>=6.0
  - scipy>=1.10
  - scikit-learn>=1.3
  - scikit-image>=0.21
  - pillow>=10.0
  - tqdm

  # 医療画像処理（conda-forge）
  - simpleitk>=2.3
  - nibabel>=5.0

  - pip
  - pip:
    # DICOM処理
    - pydicom>=2.4
    - dicom2nifti>=2.4
    - python-gdcm>=3.0

    # セグメンテーション
    # TotalSegmentator 2.x系（nnunetv2依存）
    - TotalSegmentator>=2.0,<3.0

    # Radiomics特徴量抽出
    # 注意: pyradiomics 3.1.1はNumPy 1.x系と互換
    - pyradiomics>=3.0,<4.0

    # 可視化
    - seaborn>=0.12

    # その他
    - imageio>=2.30
